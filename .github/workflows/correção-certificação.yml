name: CorreÃ§Ã£o e CertificaÃ§Ã£o
on: 
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - labeled
      - unlabeled
jobs:
  Codaqui:
    name: ExecuÃ§Ã£o dos Testes
    runs-on: ubuntu-latest
    if: contains( github.event.pull_request.labels.*.name, 'Executar')
    steps:
    
      - name: BoasVindas
        run: |
          echo "ğŸ‰ Muito legal, vocÃª estÃ¡ tentando realizar a certificaÃ§Ã£o de Python da Codaqui!"
          echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
          echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: Check out repository code
        uses: actions/checkout@v2   
        
      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      
      - name: "âš™ï¸ Configurando verificaÃ§Ã£o automÃ¡tica de certificado..."
        run: |
          pip3 install pytest
          python -m pytest tests/test_config.py
    
      - name: "ğŸ“š Projeto 1 - Hello World!"
        run: |
          hello_world_output=$(python submission/projeto1/main.py)
          if [ "$hello_world_output" != "Hello World!" ]; then
              echo "âŒ Ocorreu um erro, nÃ£o conseguimos identificar o Hello World!";
              exit 1;
          else
              echo "âœ”ï¸ Esta atividade estÃ¡ aprovada!";
          fi
          
      - name: "ğŸ“š Projeto 2 - Tipos e VariÃ¡veis"
        run: |
          python -m pytest tests/test_projeto2.py
          
      - name: "ğŸ“š Projeto 3 - Listas e ColeÃ§Ãµes"
        run: |
          python -m pytest tests/test_projeto3.py
  
  Certificado:
    name: Aprovado! Vamos gerar o seu certificado =)
    runs-on: ubuntu-latest
    if: contains( github.event.pull_request.labels.*.name, 'Aprovado')
    steps:

      - name: AprovaÃ§Ã£o!
        run: |
          echo "ğŸ‰ Muito legal, tudo indica que seu certificado foi aprovado!"
          echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
          echo "ğŸ” UsuÃ¡rio: ${{ github.event.pull_request.user.login }} (${{ github.event.pull_request.user.id }})"
          echo "ğŸ” ID do Certificado: ${{ github.event.pull_request.id }}"
          echo "ğŸ” Titulo: ${{ github.event.pull_request.title }}"
          bash certificado/generator.sh ${{ github.event.pull_request.user.login }} ${{ github.event.pull_request.user.id }} ${{ github.event.pull_request.id }} ${{ github.event.pull_request.title }}
          
          
